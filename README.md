# MCP + Ollama: –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç **MCP (Model Context Protocol)** –∏ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é LLM (Ollama) –∫ MCP-—Å–µ—Ä–≤–µ—Ä—É —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.

## –ß—Ç–æ —Ç–∞–∫–æ–µ MCP?

**Model Context Protocol (MCP)** ‚Äî —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Anthropic, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç LLM-–º–æ–¥–µ–ª—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ MCP:

1. **–°–µ—Ä–≤–µ—Ä (MCP Server)** ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã
2. **–ö–ª–∏–µ–Ω—Ç (MCP Client)** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–æ–±—ã—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å LLM)
3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools)** ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ LLM –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å
4. **–†–µ—Å—É—Ä—Å—ã (Resources)** ‚Äî –¥–∞–Ω–Ω—ã–µ, –∫ –∫–æ—Ç–æ—Ä—ã–º LLM –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    MCP Protocol    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LLM       ‚îÇ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí ‚îÇ MCP Server  ‚îÇ
‚îÇ  (Ollama)   ‚îÇ     JSON-RPC       ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                           ‚îÇ
                                           ‚ñº
                                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                   ‚îÇ  Tools &    ‚îÇ
                                   ‚îÇ  Resources  ‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- `mcp_server.py` ‚Äî MCP-—Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- `ollama_mcp_client.py` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Ollama –∫ MCP-—Å–µ—Ä–≤–µ—Ä—É
- `run_demo.py` ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
- `requirements.txt` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à –ø—Ä–∏–º–µ—Ä

### 1. MCP-—Å–µ—Ä–≤–µ—Ä (`mcp_server.py`)

–°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 4 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

- **`read_file`** ‚Äî —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- **`write_file`** ‚Äî –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
- **`list_directory`** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- **`get_file_info`** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ MCP-—Å–µ—Ä–≤–µ—Ä–∞:

```python
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
server = Server("file-operations-server")

# 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
@server.list_tools()
async def handle_list_tools() -> List[Tool]:
    return [Tool(...), Tool(...)]

# 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
@server.call_tool()
async def handle_call_tool(name: str, arguments: Dict) -> List[TextContent]:
    # –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
```

### 2. MCP-–∫–ª–∏–µ–Ω—Ç (`ollama_mcp_client.py`)

–ö–ª–∏–µ–Ω—Ç:
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç MCP-—Å–µ—Ä–≤–µ—Ä –∫–∞–∫ subprocess
2. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ stdio
3. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –∏—Ö —Å Ollama

#### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã:

```python
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP-—Å–µ—Å—Å–∏–∏
session = ClientSession(read_stream, write_stream)
await session.initialize(InitializeRequest(...))

# 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
tools = await session.list_tools()

# 3. –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
result = await session.call_tool(tool_name, arguments)
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama

–ü–æ—Å–∫–æ–ª—å–∫—É Ollama –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç MCP –Ω–∞—Ç–∏–≤–Ω–æ, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥:

1. **–û–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ
2. **–ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç** LLM –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. **–í—ã–ø–æ–ª–Ω—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** —á–µ—Ä–µ–∑ MCP
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```python
# –ü—Ä–æ–º–ø—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
system_prompt = f"""
–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–ª–µ–¥—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º:
{tools_description}

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –æ—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
TOOL_CALL: {{"name": "tool_name", "arguments": {...}}}
"""

# –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
if "TOOL_CALL:" in response:
    tool_call = json.loads(response_part)
    result = await execute_tool(tool_call["name"], tool_call["arguments"])
```

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ollama**: https://ollama.ai/
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Ollama**: `ollama serve`
3. **–°–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å**: `ollama pull llama3.2`

### –ó–∞–ø—É—Å–∫:

```bash
# –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
python run_demo.py

# –°–ø–æ—Å–æ–± 2: –ù–∞–ø—Ä—è–º—É—é
pip install -r requirements.txt
python ollama_mcp_client.py
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:

```
üë§ –í—ã: –ø–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç list_directory –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã]

üë§ –í—ã: —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª hello.txt —Å —Ç–µ–∫—Å—Ç–æ–º "–ü—Ä–∏–≤–µ—Ç, MCP!"
ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç write_file]

üë§ –í—ã: –ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª hello.txt
ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç read_file –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ]

üë§ –í—ã: –ø–æ–∫–∞–∂–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ hello.txt
ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç get_file_info –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä, –¥–∞—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è]
```

## –ü—Ä–æ—Ç–æ–∫–æ–ª MCP –≤ –¥–µ—Ç–∞–ª—è—Ö

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2024-11-05",
    "capabilities": {},
    "clientInfo": {
      "name": "ollama-mcp-client",
      "version": "1.0.0"
    }
  }
}
```

### –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/list"
}
```

### –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/call",
  "params": {
    "name": "read_file",
    "arguments": {
      "path": "/path/to/file.txt"
    }
  }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MCP

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º
2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –µ–¥–∏–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
4. **–ò–Ω—Ç–µ—Ä–æ–ø–µ—Ä–∞–±–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ LLM

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–ë–æ–ª—å—à–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** ‚Äî HTTP API, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥
2. **Authentification** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. **Resources** ‚Äî –ø–æ–º–∏–º–æ tools, –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
4. **Streaming** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥** –≤–º–µ—Å—Ç–æ –Ω–∞—Ç–∏–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ MCP –≤ Ollama
2. **–ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥** JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ LLM (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–º)
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ error handling** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [MCP Specification](https://spec.modelcontextprotocol.io/)
- [MCP Python SDK](https://github.com/modelcontextprotocol/python-sdk)
- [Ollama API](https://github.com/ollama/ollama/blob/main/docs/api.md)

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —É–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.